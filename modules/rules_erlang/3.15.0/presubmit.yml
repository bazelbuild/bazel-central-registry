shell_commands: &shell_commands
- curl -O https://raw.githubusercontent.com/kerl/kerl/master/kerl
- chmod a+x kerl
- ./kerl update releases
- ./kerl build ${ERLANG_VERSION}
- ./kerl install ${ERLANG_VERSION} ~/kerl/${ERLANG_VERSION}
- realpath ~/kerl/${ERLANG_VERSION}

matrix:
  platform:
  - macos
  - ubuntu2004
  bazel:
  - 7.x
tasks:
  verify_targets:
    name: Verify build targets
    platform: ${{ platform }}
    bazel: ${{ bazel }}
    environment:
      ERLANG_VERSION: "26.2"
    shell_commands: *shell_commands
    build_flags:
    - --incompatible_strict_action_env
    build_targets:
    - '@rules_erlang//...'
