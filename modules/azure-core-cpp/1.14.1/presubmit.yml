matrix:
  platform:
    - debian10
    - debian11
    - macos
    - macos_arm64
    - ubuntu2004
    - ubuntu2204
    - ubuntu2404
    # - windows
  bazel: [7.x, 8.x, rolling]
tasks:
  verify_targets_no_transport:
    name: Build with no HTTP transport
    platform: ${{ platform }}
    bazel: ${{ bazel }}
    build_targets:
      - "@azure-core-cpp//:azure-core-cpp"
    build_flags:
      - "--//:build_transport_curl=false"
      - "--//:build_transport_winhttp=false"
  verify_targets_curl_transport:
    name: Build with Curl as HTTP transport
    platform: ${{ platform }}
    bazel: ${{ bazel }}
    build_targets:
      - "@azure-core-cpp//:azure-core-cpp"
    build_flags:
      - "--//:build_transport_curl=true"
      - "--//:build_transport_winhttp=false"
  # Enable once wil is in the BCR:
  #   https://github.com/bazelbuild/bazel-central-registry/issues/3807
  # verify_targets_winhttp_transport:
  #   name: Build with WinHTTP as HTTP transport
  #   platform: ${{ platform }}
  #   bazel: ${{ bazel }}
  #   build_targets:
  #     - "@azure-core-cpp//:azure-core-cpp"
  #   build_flags:
  #     - "--//:build_transport_curl=false"
  #     - "--//:build_transport_winhttp=true"
  # verify_targets_all_transports:
  #   name: Build with all HTTP transports
  #   platform: ${{ platform }}
  #   bazel: ${{ bazel }}
  #   build_targets:
  #     - "@azure-core-cpp//:azure-core-cpp"
  #   build_flags:
  #     - "--//:build_transport_curl=true"
  #     - "--//:build_transport_winhttp=true"
