matrix:
  unix_platform:
    - debian11
    - ubuntu2004
    - ubuntu2204
    - ubuntu2404
    - macos
    - macos_arm64
  bazel:
    - 7.x
    - 8.x
    - rolling

tasks:
  verify_targets_unix:
    platform: ${{ unix_platform }}
    bazel: ${{ bazel }}
    build_flags:
      - "--cxxopt=-std=c++17"
      - "--host_cxxopt=-std=c++17"
    build_targets:
      - "@grpc//:grpc"
      - "@grpc//:grpc_unsecure"
      - "@grpc//:grpc_opencensus_plugin"
      - "@grpc//:grpc_security_base"
      - "@grpc//:grpc++"
      - "@grpc//:grpc++_unsecure"
      - "@grpc//:grpc++_reflection"
      - "@grpc//:grpc++_test"
      - "@grpc//:grpcpp_admin"
      - "@grpc//:grpcpp_channelz"
      - "@grpc//:grpcpp_csds"
      - "@grpc//:grpcpp_orca_service"
      - "@grpc//examples/protos/..."

  verify_targets_unix_openssl:
    platform: ${{ unix_platform }}
    bazel: ${{ bazel }}
    build_flags:
      - "--cxxopt=-std=c++17"
      - "--host_cxxopt=-std=c++17"
      - "--@grpc//third_party:use_openssl=true"
    build_targets:
      - "@grpc//:grpc"
      - "@grpc//:grpc_unsecure"
      - "@grpc//:grpc_opencensus_plugin"
      - "@grpc//:grpc_security_base"
      - "@grpc//:grpc++"
      - "@grpc//:grpc++_unsecure"
      - "@grpc//:grpc++_reflection"
      - "@grpc//:grpc++_test"
      - "@grpc//:grpcpp_admin"
      - "@grpc//:grpcpp_channelz"
      - "@grpc//:grpcpp_csds"
      - "@grpc//:grpcpp_orca_service"
      - "@grpc//examples/protos/..."

  verify_targets_windows:
    platform: "windows"
    bazel: ${{ bazel }}
    build_flags:
      - "--cxxopt=/std:c++17"
      - "--host_cxxopt=/std:c++17"
      - "@grpc//:grpc"
      - "@grpc//:grpc_unsecure"
      - "@grpc//:grpc_opencensus_plugin"
      - "@grpc//:grpc_security_base"
      - "@grpc//:grpc++"
      - "@grpc//:grpc++_unsecure"
      - "@grpc//:grpc++_reflection"
      - "@grpc//:grpc++_test"
      - "@grpc//:grpcpp_admin"
      - "@grpc//:grpcpp_channelz"
      - "@grpc//:grpcpp_csds"
      - "@grpc//:grpcpp_orca_service"

  verify_targets_windows_openssl:
    platform: "windows"
    bazel: ${{ bazel }}
    build_flags:
      - "--cxxopt=/std:c++17"
      - "--host_cxxopt=/std:c++17"
      - "--@grpc//third_party:use_openssl=true"
    build_targets:
      - "@grpc//:grpc"
      - "@grpc//:grpc_unsecure"
      - "@grpc//:grpc_opencensus_plugin"
      - "@grpc//:grpc_security_base"
      - "@grpc//:grpc++"
      - "@grpc//:grpc++_unsecure"
      - "@grpc//:grpc++_reflection"
      - "@grpc//:grpc++_test"
      - "@grpc//:grpcpp_admin"
      - "@grpc//:grpcpp_channelz"
      - "@grpc//:grpcpp_csds"
      - "@grpc//:grpcpp_orca_service"
