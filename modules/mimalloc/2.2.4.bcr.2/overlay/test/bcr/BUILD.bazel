load("@rules_cc//cc:cc_binary.bzl", "cc_binary")
load("@rules_cc//cc:cc_test.bzl", "cc_test")
load("@rules_shell//shell:sh_test.bzl", "sh_test")

sh_test(
    name = "override_test",
    srcs = ["override_test.sh"],
    data = [":simple_cat"],
    env = {"SIMPLE_CAT": "$(rlocationpath :simple_cat)"},
    deps = ["@bazel_tools//tools/bash/runfiles"],
    # TODO(zbarsky): Failing in BCR CI with `Symlinking //:override_test failed: failed to create symbolic link 'bazel-out/k8-fastbuild/bin/override_test': file 'override_test.sh' is not executable`
    tags = ["manual"],
)

cc_binary(
    name = "simple_cat",
    srcs = ["simple_cat.c"],
    malloc = "@mimalloc",
)

cc_test(
    name = "api_test",
    srcs = ["api_test.c"],
    malloc = "@mimalloc",
    deps = [
        "@mimalloc//:mimalloc-api",
        "@mimalloc//:mimalloc-stats",
    ],
)
