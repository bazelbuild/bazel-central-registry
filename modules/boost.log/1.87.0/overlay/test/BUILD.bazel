load("@rules_cc//cc:defs.bzl", "cc_library", "cc_test")

cc_library(
    name = "common",
    hdrs = glob(["common/*.hpp"]),
    includes = ["common"],
    deps = [
        "@boost.log",
        "@boost.move",
        "@boost.mpl",
    ],
)

[cc_test(
    name = "test_" + test,
    timeout = "short",
    srcs = [test],
    deps = [
        ":common",
        "@boost.log",
        "@boost.test",
        "@boost.test//:unit_test_main",
        "@boost.thread",
    ],
) for test in glob(
    ["run/*.*pp"],
    exclude = ["run/filt_matches_xpressive.cpp"],
)]

[cc_test(
    name = "test_" + test,
    timeout = "short",
    srcs = [test],
    deps = [
        "@boost.assert",
        "@boost.log",
        "@boost.type_traits",
    ],
) for test in glob(
    ["compile/*.*pp"],
    exclude = ["compile/self_contained_header.cpp"],
)]
