load("@rules_cc//cc:defs.bzl", "cc_library")

package(default_visibility = ["//visibility:public"])

cc_library(
    name = "wait_utils",
    hdrs = [
        "WaitUtils.h",
    ],
    deps = [
        ":core",
        ":fiber_manager",
        "//folly/fibers:core",
        "//folly/fibers:fiber_manager_map",
    ],
)

cc_library(
    name = "core",
    srcs = ["Async.cpp"],
    hdrs = [
        "Async.h",
    ],
    deps = [
        "//folly:traits",
        "//folly:unit",
        "//folly/fibers:core",
        "//folly/functional:invoke",
        "//folly/lang:customization_point",
        "@glog",
    ],
)

cc_library(
    name = "collect",
    hdrs = [
        "Collect.h",
    ],
    textual_hdrs = [
        "Collect-inl.h",
    ],
    deps = [
        ":baton",
        ":core",
        ":fiber_manager",
        ":future",
        "//folly:traits",
        "//folly:try",
        "//folly/fibers:core_manager",
        "//folly/fibers:when_n",
        "//folly/functional:invoke",
    ],
)

cc_library(
    name = "baton",
    hdrs = ["Baton.h"],
    deps = [
        ":core",
        "//folly/fibers:core",
        "@glog",
    ],
)

cc_library(
    name = "fiber_manager",
    hdrs = [
        "FiberManager.h",
    ],
    deps = [
        ":core",
        "//folly/fibers:core_manager",
    ],
)

cc_library(
    name = "future",
    hdrs = [
        "Future.h",
    ],
    deps = [
        ":core",
        "//folly/futures:core",
    ],
)

cc_library(
    name = "promise",
    hdrs = [
        "Promise.h",
    ],
    deps = [
        ":core",
        "//folly/fibers:core_manager",
        "//folly/fibers:traits",
    ],
)

cc_library(
    name = "task",
    hdrs = [
        "Task.h",
    ],
    deps = [
        ":core",
        "//folly/coro:blocking_wait",
        "//folly/coro:task",
    ],
)

cc_library(
    name = "stack_tracing",
    hdrs = [
        "AsyncStack.h",
    ],
    deps = [
        ":core",
        "//folly:c_portability",
        "//folly:scope_guard",
        "//folly/tracing:async_stack",
        "@glog",
    ],
)
