load("@rules_cc//cc:defs.bzl", "cc_test")

TEST_SRCS = glob(
    ["*.c"],
    exclude = [
        "z_api_alignment_test.c",
        "z_api_shm_test.c",
        "z_build_static.c",
    ],
)

TEST_NAMES = [src.replace(".c", "") for src in TEST_SRCS]

[cc_test(
    name = test_name,
    size = "small",
    srcs = [
        test_name + ".c",
        "z_int_helpers.h",
    ],
    linkopts = select({
        "@platforms//os:linux": [
            "-lrt",
            "-lpthread",
        ],
        "//conditions:default": [],
    }),
    deps = ["@zenohc"],
) for test_name in TEST_NAMES]
